let roomVS = `precision highp float;
attribute vec4 aVertexPosition;uniform mat4 uProjectionMatrix;varying vec2 vUvs;varying vec4 vViewVector;mat4 v(mat4 v){return mat4(v[0][0],v[1][0],v[2][0],0.,v[0][1],v[1][1],v[2][1],0.,v[0][2],v[1][2],v[2][2],0.,-dot(v[0].xyz,v[3].xyz),-dot(v[1].xyz,v[3].xyz),-dot(v[2].xyz,v[3].xyz),1.);}void main(){vUvs=(aVertexPosition.xy+vec2(1.))*.5,vViewVector=v(uProjectionMatrix)*vec4(aVertexPosition.xy,1.,1.),vViewVector/=vViewVector.w,gl_Position=vec4(aVertexPosition.xy,0.,1.);}`;
let roomFS = `precision highp float;
varying vec2 vUvs;varying vec4 vViewVector;uniform mat4 uModelViewMatrix;float v(vec3 v,vec3 f){return dot(v,f);}float f(vec3 v,vec3 m){vec3 f=abs(v)-m;return length(max(f,0.))+min(max(f.x,max(f.y,f.z)),0.);}float f(vec3 v,vec3 m,float f){vec3 y=abs(v)-m;return length(max(y,0.))-f+min(max(y.x,max(y.y,y.z)),0.);}float x(float v,float f){return max(v,f);}vec3 m(vec3 v,vec3 f){return mod(v,f)-.5*f;}float m(float v,float m,float f){float y=clamp(.5+.5*(m-v)/f,0.,1.);return mix(m,v,y)-f*y*(1.-y);}const vec3 y=vec3(.3,.13,.03);float f(vec3 v){const float x=.95;vec3 z=m(v,vec3(y.xy*4.,0.));return f(z,y*vec3(.8*x,.5*x,1.),.05);}float m(vec3 v){return min(f(v),f(v-vec3(y.x*2.,0.,0.)));}float v(vec3 z){float i=v(z,vec3(0.,0.,1.)),r=min(m(z),m(z-vec3(y.x,y.y*2.,0.)));return x(m(i,r,.05),f(z,vec3(1.,1.,1.)));}vec2 x(vec3 f){return vec2(v(f),-1.);}vec3 n(in vec3 v){const float f=.0001;vec2 m=vec2(1.,-1.)*.5773;return normalize(m.xyy*x(v+m.xyy*f).x+m.yyx*x(v+m.yyx*f).x+m.yxy*x(v+m.yxy*f).x+m.xxx*x(v+m.xxx*f).x);}mat4 t(mat4 v){return mat4(v[0][0],v[1][0],v[2][0],0.,v[0][1],v[1][1],v[2][1],0.,v[0][2],v[1][2],v[2][2],0.,-dot(v[0].xyz,v[3].xyz),-dot(v[1].xyz,v[3].xyz),-dot(v[2].xyz,v[3].xyz),1.);}float f(vec3 v,vec3 m,float f,float z){float y=1.,r=f;for(int i=0;i<32;i++){float n=x(v+m*r).x;y=min(y,10.*n/r);r+=n;if(abs(n)<.001||r>z)break;}return step(.01,y);}void main(){const float v=3.;vec3 m=vec3(0.),y;vec2 i;float r=.1;mat4 z=t(uModelViewMatrix);vec3 a=normalize(vViewVector.xyz);for(int l=0;l<64;l++){y=a*r;y=vec3(z*vec4(y,1.));i=x(y);float u=i.x;if(abs(u)<.001||r>20.)break;r+=u;}if(r<20.){vec3 u=normalize(vec3(1.,1.,1.));if(i.y>0.)m=vec3(1.,0.,0.);else m=vec3(.6);vec3 l=n(y);float e=1.;e*=max(0.,dot(u,l));e*=f(y,u,.05,20.);m*=min(1.,.4+e);}gl_FragColor=vec4(m.xyz,1.);}`;
