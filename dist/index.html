<!DOCTYPE html><p><script>let t={};let e=0,n=[0,1,3],v=[0,0,-1];function o(r){let l=t.t;const g=(r*=.001)-e;if(e=r,l.clear(l.COLOR_BUFFER_BIT),l.bindBuffer(l.ARRAY_BUFFER,t.v),l.vertexAttribPointer(t.o,2,l.FLOAT,!1,0,0),l.enableVertexAttribArray(t.o),l.useProgram(t.i),x=w,y=M,w=0,M=0,0!=x){let t=function(t,e,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const v=Math.cos(e),o=Math.sin(e),r=1-v;return n[0]=v+t[0]*t[0]*r,n[1]=t[0]*t[1]*r+t[2]*o,n[2]=t[0]*t[2]*r-t[1]*o,n[4]=t[0]*t[1]*r-t[2]*o,n[5]=v+t[1]*t[1]*r,n[6]=t[1]*t[2]*r+t[0]*o,n[8]=t[0]*t[2]*r+t[1]*o,n[9]=t[1]*t[2]*r-t[0]*o,n[10]=v+t[2]*t[2]*r,n}([0,1,0],g*-x);v=m(v=function(t,e,n,v=[0,0,0]){let o=[...e,n];for(let e=0;e<3;e++){v[e]=0;for(let n=0;n<4;n++)v[e]+=t[4*n+e]*o[n]}return v}(t,v,0))}let h=f(v,g),p=u(v,[0,1,0]);p=f(m(p),g),b(s)&&(n=c(n,h,n)),b(z)&&(n=i(n,h,n)),b(d)&&(n=i(n,p,n)),b(V)&&(n=c(n,p,n));let P=function(t,e,n,v=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){let o=m(i(e,t)),r=m(u(o,n)),c=u(r,o);return v[0]=r[0],v[4]=r[1],v[8]=r[2],v[1]=c[0],v[5]=c[1],v[9]=c[2],v[2]=-o[0],v[6]=-o[1],v[10]=-o[2],v[12]=-a(r,t),v[13]=-a(c,t),v[14]=a(o,t),v}(n,c(n,v),[0,1,0]),k=function(t,e,n,v,o,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const c=Math.cos(.5*t)/Math.sin(.5*t),i=c*n/e;return r[0]=i,r[5]=c,r[10]=-(o+v)/(o-v),r[11]=-1,r[14]=-2*o*v/(o-v),r}(.5*Math.PI,t.t.canvas.height,t.t.canvas.width,.1,100);l.uniformMatrix4fv(t.m,!1,P),l.uniformMatrix4fv(t.u,!1,k),l.drawArrays(l.TRIANGLE_STRIP,0,4),requestAnimationFrame(o)}function r(t,e,n){const v=t.createShader(e);return t.shaderSource(v,n),t.compileShader(v),v}function c(t,e,n=[0,0,0]){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function i(t,e,n=[0,0,0]){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function f(t,e,n=[0,0,0]){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function a(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function m(t,e=[0,0,0]){let n=function(t){return Math.sqrt(a(t,t))}(t);return e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n,e}function u(t,e,n=[0,0,0]){return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0],n}window.onload=function(){const e=document.createElement("canvas");let n=e.getContext("webgl");t.t=n,e.width=800,e.height=600,t.t.viewport(0,0,t.t.canvas.width,t.t.canvas.height),document.body.appendChild(e),n.clearColor(0,1,0,1);var v=function(t,e,n){const v=r(t,t.VERTEX_SHADER,e),o=r(t,t.FRAGMENT_SHADER,n),c=t.createProgram();t.attachShader(c,v),t.attachShader(c,o),t.linkProgram(c),!1;return c}(n,k,A);t.o=n.getAttribLocation(v,"aVertexPosition"),t.u=n.getUniformLocation(v,"uProjectionMatrix"),t.m=n.getUniformLocation(v,"uModelViewMatrix"),t.i=v,function(e){const n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,1,1,-1]),e.STATIC_DRAW),t.v=n}(n),document.body.addEventListener("keydown",g,!1),document.body.addEventListener("keyup",h,!1),document.addEventListener("pointerlockchange",P,!1),document.addEventListener("mozpointerlockchange",P,!1),e.addEventListener("click",()=>(function(){let e=t.t.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock,e.requestPointerLock()})(),!1),requestAnimationFrame(o)};let x,y,l={},s="KeyW",z="KeyS",d="KeyA",V="KeyD",w=0,M=0;function g(t){l[t.code]=!0}function h(t){l[t.code]=!1}function p(t){t.movementX&&(w+=t.movementX),t.movementY&&(M+=t.movementY)}function P(){document.pointerLockElement===t.t.canvas||document.mozPointerLockElement===t.t.canvas?document.addEventListener("mousemove",p,!1):document.removeEventListener("mousemove",p,!1)}function b(t){return!!l[t]}let k="precision highp float;\nattribute vec4 aVertexPosition;uniform mat4 uProjectionMatrix;varying vec2 vUvs;varying vec4 vViewVector;mat4 v(mat4 v){return mat4(v[0][0],v[1][0],v[2][0],0.,v[0][1],v[1][1],v[2][1],0.,v[0][2],v[1][2],v[2][2],0.,-dot(v[0].xyz,v[3].xyz),-dot(v[1].xyz,v[3].xyz),-dot(v[2].xyz,v[3].xyz),1.);}void main(){vUvs=(aVertexPosition.xy+vec2(1.))*.5,vViewVector=v(uProjectionMatrix)*vec4(aVertexPosition.xy,1.,1.),vViewVector/=vViewVector.w,gl_Position=vec4(aVertexPosition.xy,0.,1.);}",A="precision highp float;\nvarying vec2 vUvs;varying vec4 vViewVector;uniform mat4 uModelViewMatrix;float v(vec3 v,vec3 f){return dot(v,f);}float f(vec3 v,vec3 m){vec3 f=abs(v)-m;return length(max(f,0.))+min(max(f.x,max(f.y,f.z)),0.);}float f(vec3 v,vec3 m,float f){vec3 y=abs(v)-m;return length(max(y,0.))-f+min(max(y.x,max(y.y,y.z)),0.);}float x(float v,float f){return max(v,f);}vec3 m(vec3 v,vec3 f){return mod(v,f)-.5*f;}float m(float v,float m,float f){float y=clamp(.5+.5*(m-v)/f,0.,1.);return mix(m,v,y)-f*y*(1.-y);}const vec3 y=vec3(.3,.13,.03);float f(vec3 v){const float x=.95;vec3 z=m(v,vec3(y.xy*4.,0.));return f(z,y*vec3(.8*x,.5*x,1.),.05);}float m(vec3 v){return min(f(v),f(v-vec3(y.x*2.,0.,0.)));}float v(vec3 z){float i=v(z,vec3(0.,0.,1.)),r=min(m(z),m(z-vec3(y.x,y.y*2.,0.)));return x(m(i,r,.05),f(z,vec3(1.,1.,1.)));}vec2 x(vec3 f){return vec2(v(f),-1.);}vec3 n(in vec3 v){const float f=.0001;vec2 m=vec2(1.,-1.)*.5773;return normalize(m.xyy*x(v+m.xyy*f).x+m.yyx*x(v+m.yyx*f).x+m.yxy*x(v+m.yxy*f).x+m.xxx*x(v+m.xxx*f).x);}mat4 t(mat4 v){return mat4(v[0][0],v[1][0],v[2][0],0.,v[0][1],v[1][1],v[2][1],0.,v[0][2],v[1][2],v[2][2],0.,-dot(v[0].xyz,v[3].xyz),-dot(v[1].xyz,v[3].xyz),-dot(v[2].xyz,v[3].xyz),1.);}float f(vec3 v,vec3 m,float f,float z){float y=1.,r=f;for(int i=0;i<32;i++){float n=x(v+m*r).x;y=min(y,10.*n/r);r+=n;if(abs(n)<.001||r>z)break;}return step(.01,y);}void main(){const float v=3.;vec3 m=vec3(0.),y;vec2 i;float r=.1;mat4 z=t(uModelViewMatrix);vec3 a=normalize(vViewVector.xyz);for(int l=0;l<64;l++){y=a*r;y=vec3(z*vec4(y,1.));i=x(y);float u=i.x;if(abs(u)<.001||r>20.)break;r+=u;}if(r<20.){vec3 u=normalize(vec3(1.,1.,1.));if(i.y>0.)m=vec3(1.,0.,0.);else m=vec3(.6);vec3 l=n(y);float e=1.;e*=max(0.,dot(u,l));e*=f(y,u,.05,20.);m*=min(1.,.4+e);}gl_FragColor=vec4(m.xyz,1.);}";</script>
